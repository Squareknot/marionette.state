// Marionette.State v0.2.0

!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","backbone.marionette","underscore"],function(a,c,d){return b(a,c,d)});else if("undefined"!=typeof exports){var c=require("backbone"),d=require("backbone.marionette"),e=require("underscore");module.exports=b(c,d,e)}else b(a.Backbone,a.Backbone.Marionette,a._)}(this,function(a,b,c){"use strict";return b.State=b.Object.extend({modelClass:void 0,defaultState:void 0,componentEvents:void 0,_model:void 0,_component:void 0,_initialState:void 0,constructor:function(c){c=c||{},c.component&&this.setComponent(c.component),this.modelClass=c.modelClass||this.modelClass||a.Model,this.setState(c.initialState),b.State.__super__.constructor.apply(this,arguments)},setState:function(a,b){this._initialState=c.extend({},this.defaultState,a),this._model?this.reset(b):this._model=new this.modelClass(this._initialState)},getModel:function(){return this._model},getInitialState:function(){return c.clone(this._initialState)},reset:function(a){a=c.extend({unset:!0},a),this._model.set(this._initialState,a)},set:function(){if(!this._model)throw new b.Error("Initialize state first.");this._model.set.apply(this._model,arguments)},get:function(){if(!this._model)throw new b.Error("Initialize state first.");return this._model.get.apply(this._model,arguments)},setComponent:function(a){this.stopListening(this._component,"destroy"),this.componentEvents&&this.unbindEntityEvents(this._component,this.componentEvents),this._component=a,this.listenToOnce(this._component,"destroy",this.destroy),this.componentEvents&&this.bindEntityEvents(this._component,this.componentEvents)},getComponent:function(){return this._component},syncEntityEvents:function(a,c){b.State.syncEntityEvents(this,a,c)}}),b.State.Behavior=b.Behavior.extend({initialize:function(a){if(a=a||{},!a.stateClass)throw new b.Error("Must provide 'stateClass'.");var d=a.stateClass,e=a.syncEvent||"render",f=c.extend({initialState:a.initialState,component:this.view},a.stateOptions,this._mapOptions(a.mapOptions)),g=new d(f);if(this.view.state)throw new Error("View already contains a state attribute.");this.view.state=g.getModel(),this.view.stateEvents&&b.State.syncEntityEvents(this.view,this.view.state,this.view.stateEvents,e),a.serialize&&this._wrapSerializeData()},_mapOptions:function(a){return a?c.object(c.map(a,this._mapOption,this)):{}},_mapOption:function(a,d){var e;if(d===!0)e=this.view.options[d];else if(c.isString(a))e=c.reduce(a.split("."),function(a,b){return a[b]},this.view.options);else{if(!c.isFunction(a))throw new b.Error("Invalid mapOption type");e=a.call(this.view,this.view.options)}return[d,e]},_wrapSerializeData:function(){var a=this.view.serializeData,d=this.view.state;this.view.serializeData=function(){var e=a.call(this),f=c.clone(d.attributes);if(c.isUndefined(e.state))e.state=f;else{if(!c.isObject(e.state))throw new b.Error("'state' already defined and not extensible.");this._mergeAttrs(e.state,f)}return e}},_mergeAttrs:function(a,d){for(var e in d){if(!c.isUndefined(a[e]))throw new b.Error("Attribute '"+e+"' already defined.");a[e]=d[e]}}}),function(a,b,c){function d(a,b,d,e){var f=e?b.get(e):void 0;if(c.isFunction(d))d.call(a,b,f);else{var g=d.split(i);c.each(g,function(c){a[c](b,f)})}}function e(b,c,e,f){var g;if("change"===e||"all"===e||c instanceof a.Collection&&"reset"===e)d(b,c,f);else if(c instanceof a.Model&&(g=e.match(h))){var i=g[1];d(b,c,f,i)}}function f(a,b,d,f){c.each(d,function(c){e(a,b,c,f)})}function g(a,b,d){c.each(d,function(c,d){var e=d.split(i);f(a,b,e,c)},this)}var h=/^change:(.+)/,i=/\s+/;c.extend(b.State,{syncEntityEvents:function(a,d,e,f){if(b.bindEntityEvents(a,d,e),f){var h=c.partial(g,a,d,e),i={entity:d,bindings:e,event:f,handler:h};a.__syncingEntityEvents=a.__syncingEntityEvents||[],a.__syncingEntityEvents.push(i),a.on(f,h)}else g(a,d,e)},stopSyncingEntityEvents:function(a,d,e){b.unbindEntityEvents(a,d,e),a.render&&a.__syncingEntityEvents&&c.each(a.__syncingEntityEvents,function(b){d===b.entity&&e===b.bindings&&a.off(b.event,b.handler)})}})}(a,b,c),b.State});
//# sourceMappingURL=marionette.state.min.map