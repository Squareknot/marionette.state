!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("underscore"),require("backbone"),require("backbone.marionette")):"function"==typeof define&&define.amd?define(["underscore","backbone","backbone.marionette"],n):t.Marionette.State=n(t._,t.Backbone,t.Mn)}(this,function(t,n,e){"use strict";function i(n,e,i,s){var o=s?e.get(s):void 0;if(t.isFunction(i))i.call(n,e,o);else{var r=i.split(d);t.each(r,function(t){n[t](e,o)})}}function s(t,e,s,o){var r;if("change"===s||"all"===s||e instanceof n.Collection&&"reset"===s)i(t,e,o);else if((e instanceof n.Model||e instanceof c)&&(r=s.match(u))){var h=r[1];i(t,e,o,h)}}function o(n,e,i,o){t.each(i,function(t){s(n,e,t,o)})}function r(n,e,i){t.each(i,function(t,i){var s=i.split(d);o(n,e,s,t)})}function h(t,n,e){this.target=t,this.entity=n,this.bindings=e}var a=e.Object.extend({modelClass:void 0,defaultState:void 0,componentEvents:void 0,_model:void 0,_component:void 0,_initialState:void 0,constructor:function(){var t=void 0===arguments[0]?{}:arguments[0];t.bindLifecycle&&this.bindLifecycle(t.bindLifecycle),this.modelClass=t.modelClass||this.modelClass||n.Model,this.initState(t.initialState),a.__super__.constructor.apply(this,arguments)},initState:function(n,e){return this._initialState=t.extend({},this.defaultState,n),this._model?this.reset(null,e):(this._model=new this.modelClass(this._initialState),this._proxyModelEvents(this._model)),this},getInitialState:function(){return t.clone(this._initialState)},getModel:function(){return this._model},set:function(){if(!this._model)throw new e.Error("Initialize state first.");return this._model.set.apply(this._model,arguments),this},get:function(){if(!this._model)throw new e.Error("Initialize state first.");return this._model.get.apply(this._model,arguments)},reset:function(n,e){var i=t.extend({},this._initialState,n);return this._model.set(i,e),this},getChanged:function(){return this._model.changedAttributes()},getPrevious:function(){return this._model.previousAttributes()},hasAnyChanged:function(){for(var n=arguments.length,e=Array(n),i=0;n>i;i++)e[i]=arguments[i];return!!t.chain(this._model.changed).keys().intersection(e).size().value()},syncComponent:function(n,e,i){return t.isString(e)?i=e:e=e||n.stateEvents,this.componentEvents&&this.bindEntityEvents(n,this.componentEvents),e&&a.syncEntityEvents(n,this,e,i),this},stopSyncingComponent:function(t,n,e){return this.componentEvents&&this.unbindEntityEvents(t,this.componentEvents),a.stopSyncingEntityEvents(t,this,n,e),this},bindLifecycle:function(t){return this._boundDestroy||(this.boundDestroy=this.destroy.bind(this)),this.listenTo(t,"destroy",this._boundDestroy),this},unbindLifecycle:function(t){this.stopListening(t,"destroy",this._boundDestroy)},syncEntityEvents:function(t,n,e){return a.syncEntityEvents(this,t,n,e),this},_proxyModelEvents:function(t){this.listenTo(t,"all",function(){arguments.length>1&&arguments[1]===this._model&&(arguments[1]=this),this.trigger.apply(this,arguments)}.bind(this))}}),c=a,u=/^change:(.+)/,d=/\s+/;h.prototype.when=function(t,n){var e=this;return n||(n=t,t=this.target),this.eventObj=t,this.event=n,this.handler=function(){r(e.target,e.entity,e.bindings)},this.target.listenTo(this.eventObj,this.event,this.handler),this},h.prototype.now=function(){return r(this.target,this.entity,this.bindings),this},h.stop=function(){this.target.stopListening(this.eventObj,this.event,this.handler)};var l={syncEntityEvents:function(t,n,i,s){e.bindEntityEvents(t,n,i);var o=new h(t,n,i);s?o.when(s):o.now()},stopSyncingEntityEvents:function(t,n,e,i){t=n=e=i}},f=l;t.extend(c,f);var v=c;return v});
//# sourceMappingURL=marionette.state.min.js.map